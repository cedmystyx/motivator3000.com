<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Motivator 3D Viewer</title>
    <meta name="viewport" content="width=800, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <style>
        body { background: #222; margin: 0; }
        #sceneContainer { width: 800px; height: 450px; margin: 40px auto; }
    </style>
    <script>
      // Script pour changer de gesture selon les boutons du contrôleur
      AFRAME.registerComponent('gesture-switcher', {
        schema: {
          hand: {type: 'string', default: 'left'}
        },
        init: function () {
          this.currentGesture = 'open';
          this.gestures = ['open','fist','point','pistol','thumbUp'];
          this.gestureIndex = 0;
          this.el.setAttribute('hand-controls', `hand: ${this.data.hand}; handModelStyle: mesh; gesture: open`);
          // Pour la démo, on change de gesture à chaque pression du bouton trigger
          this.onButtonDown = this.onButtonDown.bind(this);
          this.el.addEventListener('abuttondown', this.onButtonDown);
          this.el.addEventListener('bbuttondown', this.onButtonDown);
          this.el.addEventListener('xbuttondown', this.onButtonDown);
          this.el.addEventListener('ybuttondown', this.onButtonDown);
          this.el.addEventListener('triggerdown', this.onButtonDown);
          this.el.addEventListener('gripdown', this.onButtonDown);
        },
        onButtonDown: function () {
          // Passe à la gesture suivante dans la liste
          this.gestureIndex = (this.gestureIndex + 1) % this.gestures.length;
          this.currentGesture = this.gestures[this.gestureIndex];
          this.el.setAttribute('hand-controls', `hand: ${this.data.hand}; handModelStyle: mesh; gesture: ${this.currentGesture}`);
        }
      });
    </script>
</head>
<body>
    <div id="sceneContainer">
        <a-scene 
          embedded 
          environment="preset: forest; shadow: true; width: 800px; height: 450px;"
        >
            <a-assets>
                <a-asset-item id="motivator-gltf" src="motivator3000/motivator.gltf"></a-asset-item>
                <img id="motivator-texture" src="motivator3000/texture.png" crossorigin="anonymous">
            </a-assets>
            <a-entity 
                gltf-model="#motivator-gltf"
                scale="5 5 5"
                position="0 1.66025 1.5678"
                rotation="89.99963750135457 0 0"
                shadow="cast: true; receive: true"
                animation="property: position; dir: alternate; dur: 2200; easing: easeInOutSine; from: 0 1.5 -2; to: 0 2 -2; loop: true"
            ></a-entity>
            <a-light 
                type="point"
                position="1 3 2"
                intensity="1"
                color="#ffffff"
                castShadow="true">
            </a-light>
            <a-entity camera 
                orbit-controls="target: 0 1 0; minDistance: 1; maxDistance: 10; initialPosition: 0 2 5;">
            </a-entity>
            <!-- Mains humaines classiques WebXR contrôlées par les boutons -->
            <a-entity gesture-switcher="hand: left"></a-entity>
            <a-entity gesture-switcher="hand: right"></a-entity>
        </a-scene>
    </div>
</body>
</html>
